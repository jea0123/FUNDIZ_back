<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.funding.mapper.CreatorMapper">

    <select id="findByIds" resultType="creator">
        SELECT *
        FROM creator
        WHERE creatorId IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

    <select id="findById" parameterType="Long" resultType="creator">
        SELECT *
        FROM creator
        WHERE creatorId = #{creatorId}
    </select>

    <select id="">
        SELECT
            (
            SELECT count(*)
            FROM project
            WHERE creatorId = #{creatorId}
            ) AS totalProject,

            (
            SELECT sum(s.*)
            FROM settlement s
            JOIN project p ON p.projectId = s.projectId
            JOIN creator c ON c.creatorId = p.creatorId
            WHERE creatorId = #{creatorId}
            ) AS totalAmount,

            (
            SELECT count(b.backingId)
            FROM backing b
            JOIN backingDetail bd ON b.backingId = bd.backingId
            JOIN reward r ON bd.rewardId = r.rewardId
            JOIN project p ON r.projectId = p.projectId
            WHERE p.creatorId = #{creatorId}
            ) AS totalBackers,

            (
            select count(*)
            from project p
            where p.creatorId = 96
            and p.projectStatus ='VERIFYING';
            ) AS pendingApproval
        FROM dual;

    </select>


    <select id="CreatorPDetailDto" parameterType="Long" resultType="com.example.funding.dto.response.creator.CreatorPDetailDto">
        SELECT
        p.projectId
        , p.creatorId
        , p.subctgrId
        , p.title
        , p.goalAmount
        , p.currAmount
        , p.startDate
        , p.endDate
        , p.thumbnail
        , p.createdAt AS createdAt
        , p.updateAt
        , p.projectStatus
        , p.backerCnt
        , p.likeCnt
        , p.viewCnt
        , p.isVerified
        , p.rejectedReason
        , p.requestedAt

        , r.rewardId
        , r.rewardName
        , r.price
        , r.rewardContent
        , r.deliveryDate
        , r.rewardCnt
        , r.createdAt AS createdAtR
        , r.isPosting
        , r.remain

        , c.creatorName

        FROM project p
        JOIN creator c ON c.creatorId = p.creatorId
        JOIN Reward r ON p.projectId = r.projectId
        WHERE p.creatorId = #{creatorId}
        Order BY p.projectId desc


    </select>
</mapper>