<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.funding.mapper.PaymentMapper">

    <select id="findRecentSuccessful" resultType="payment">
        SELECT *
        FROM PAYMENT
        WHERE STATUS IN ('PAID')
        AND CREATEDAT >= #{since}
    </select>

    <select id="backingPagePayment" resultType="com.example.funding.dto.response.payment.BackingPagePaymentDto">
        select
            p.orderId,
            p.method,
            p.status,
            p.amount,
            p.cardCompany
        From Payment p
        JOIN backing b ON b.backingId = p.backingId
        JOIN users u ON u.userId = b.userId
        WHERE u.userId = #{userId}
    </select>

    <insert id="addPayment" parameterType="com.example.funding.model.Payment">
        <selectKey keyProperty="paymentId" resultType="long" order="BEFORE">
            SELECT PAYMENT_SEQ.NEXTVAL FROM DUAL
        </selectKey>

        INSERT INTO payment (
        paymentId,
        orderId,
        backingId,
        method,
        amount,
        status
        ) VALUES (
        #{paymentId},
        #{orderId},
        #{backingId},
        #{method},
        #{amount},
        #{status}
        )
    </insert>


</mapper>