<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.funding.mapper.UserMapper">

    <select id="getLikedList" parameterType ="long" resultType="com.example.funding.dto.response.user.MyPageLikedDto">
        SELECT
        <!--  좋아요 테이블에서 가져올내용-->
        l.userId,
        l.projectId,
        l.createdAt,

        <!--창작자 테이블에서 가져올내용-->
        c.creatorId,
        c.creatorName,

        <!-- 프로젝트 테이블에서 가져올 내용-->
        p.title,
        p.goalAmount,
        p.currAmount,
        p.thumbnail,
        p.endDate

        FROM Liked l
        <!-- 테이블 조인 -->
        JOIN project p ON p.projectId = l.projectId
        JOIN creator c ON c.creatorId = p.creatorId

        WHERE l.userId=#{userId}

        ORDER BY l.createdAt DESC
    </select>
    
    <select id="isProjectLiked" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM Liked
        WHERE userId = #{userId} AND projectId = #{projectId}
    </select>
    
    <insert id="likeProject" parameterType="map">
        INSERT INTO Liked (userId, projectId)
        VALUES (#{userId}, #{projectId})
    </insert>

    <delete id="dislikeProject" parameterType="map">
        DELETE FROM Liked
        WHERE userId = #{userId} AND projectId = #{projectId}
    </delete>
</mapper>
