<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.funding.mapper.CommunityMapper">

    <select id="countTotal" resultType="Integer">
        SELECT COUNT(*)
        FROM COMMUNITY
        WHERE PROJECTID = #{projectId}
          AND CODE = #{code}
    </select>

    <select id="getCommunityById" resultType="community">
        SELECT
            CMID,
            USERID,
            PROJECTID,
            CMCONTENT,
            NVL(RATING, 0) AS rating,
            CREATEDAT,
            CODE
        FROM
        (
            SELECT ROWNUM rnum, T.*
            FROM
            (
                SELECT
                    CMID,
                    USERID,
                    PROJECTID,
                    CMCONTENT,
                    NVL(RATING, 0) AS rating,
                    CREATEDAT,
                    CODE
                FROM COMMUNITY
                WHERE PROJECTID = #{projectId}
                  AND TRIM(CODE) = 'CM'
                ORDER BY CREATEDAT DESC
            ) T
        )
        WHERE rnum BETWEEN (#{pager.page} - 1) * #{pager.size} + 1 AND (#{pager.page} * #{pager.size})
    </select>

</mapper>
